REVISIONS (v8-01-01)  
05 Mar 2008
Bob Yantosca              and Philippe Le Sager
yantosca@seas.harvard.edu     plesager@seas.harvard.edu

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% NOTE: v8-01-01 is the first version of GEOS-Chem that is %%%%%
%%%%%       compatible with the GEOS-5 met fields              %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


New in v8-01-01:
-------------------------------------------------------------------------------

gcap_global_adv         -- Split off the GEOS-4 relevant parts from the 
("transport_mod.f")        previous routine DO_GLOBAL_TRANSPORT 

geos3_global_adv        -- Split off the GEOS-3 relevant parts from the 
("transport_mod.f")        previous routine DO_GLOBAL_TRANSPORT 

geos4_geos5_global_adv  -- Split off the GEOS-4 & GEOS-5 relevant parts 
("transport_mod.f")        from the previous routine DO_GLOBAL_TRANSPORT 

transfer_3d_lp1		-- Transfers 3-D data from a REAL*4 array of 
("transfer_mod.f")         dimension (IGLOB,JGLOB,LGLOB+1) to a REAL*8 array 
                           of dimension (IIPAR,JJPAR,LLPAR+1).  Regrid in the 
                           vertical if needed.

transfer_3d_ple		-- Transfers 3-D PLE data from a REAL*4 array of 
("transfer_mod.f")         dimension (IGLOB,JGLOB,LGLOB+1) to a REAL*8 array 
                           of dimension (IIPAR,JJPAR,LLPAR+1).  Regrid in the 
                           vertical if needed.

upbdflx_hd		-- Establishes flux boundary condition for HD
("upbdflx_mod.f")          coming down from the stratosphere

CMN_NOX			-- Removed GEMISNOX array so that we do not get 
                           common-block errors 

safe_div		-- Performs a safe floating point division.  If the
("error_mod.f")            division can't be done, then return a user-defined
	 		   alternate value.


Removed in v8-01-01:
-------------------------------------------------------------------------------



Changed in v8-01-01:
-------------------------------------------------------------------------------

biogenic_oc		-- Bug fix: add MEGAN emissions to TERP_ORGC when SOA 
("carbon_mod.f")           emissions are turned on

chemdr.f		-- Now get CH4 concentrations for FUTURE_YEAR when 
                           using the future emissions scale factors

chem_tagged_ox	        -- Now use LLTROP instead of LLTROP_FIX
("tagged_ox_mod.f")

CMN_DIAG		-- Changed PD66 from 5 to 6
	                -- Added LD31 for 3-D pressure edge diagnostic

CMN_SIZE		-- Reset vertical coordinates for GEOS-5
			-- Rename GRID30LEV to GRIDREDUCED

cleanup_dao		-- Deallocate additional arrays for GEOS-5
("dao_mod.f")

cmn_fj.h		-- Removed ETAA and ETAB arrays.  We now compute PJ 
	                   directly from the GET_PEDGE routine.

copy_i6_fields		-- Don't copy TROPP2 to TROPP1 for GEOS-5
("dao_mod.f")

cossza			-- Now uses GET_LOCALTIME from "time_mod.f" to 
("dao_mod.f")              get the local time
			-- Added parallel DO loop
			-- Removed NHMSb, NSEC arguments

define.h	 	-- Rename GRID30LEV to GRIDREDUCED, since GEOS-5
			   reduced grid is 47 levels

diag1.f			-- Also now save 3-D pressure edges in ND31 instead 
                           of PS-PTOP
			-- Revert to the pre-near-land ND30 diagnostic 
                           algorithm

diag20			-- Now use LD65 instead of LLTROP_FIX 
("diag_pl_mod.f")

diag3.f			-- Now save out true pressure at 3-D level edges
	                   for ND31 diagnostic
			-- Now change category name for ND31 diagnostic 
			   from "PS-PTOP" to "PEDGE-$"
			-- Bug fix in ND28 diagnostic to allow you to print 
                           out individual biomass tracers w/o having to print 
                           all of them.

diag48			-- Bug fix: unit for tracer #77 should be "levels"
("diag48_mod.f")        -- RH should be tracer #17 under "TIME-SER" category

diag49		        -- Bug fix: unit for tracer #77 should be "levels"
("diag49_mod.f")        -- RH should be tracer #17 under "TIME-SER" category

do_convection		-- Now reference "CMN_SIZE".  Now references CLDMAS, 
("convection_mod.f")       CMFMC, DTRAIN from "dao_mod.f" so that we can pass 
                           either GEOS-5 or GEOS-3 meteorology to NFCLDMX

do_diag_pl		-- Now only loop up thru LD65 levels
("diag_pl_mod.f")

do_emissions		-- Now call EMISSDR for Tagged CO fossil fuel 
("emissions_mod.f")        emissions, so that we get the same emissions for 
                           Tagged CO as we do for the full-chemistry

do_wetdep		-- Don't do rainout/washout for convective precip
("wetscav_mod.f")          when using GEOS-5 met.  This is a recommendation
                           by Hongyu Liu. 

emfossil.f		-- Now references ITS_A_TAGCO_SIM from "tracer_mod.f"
			-- Enhance CO prod by 18.5% for tagged CO sim here 
			   instead of in "tagged_co_mod.f"

emissdr.f		-- Now also use EMLIGHTNING_NL for GEOS-5
			-- Now reference ITS_A_TAGCO_SIM from "tracer_mod.f"
			-- Now do not save biogenic ACET, ISOP, and CO
                           into EMISRR array for the tagged CO simulation
			-- Also do not archive CO from monoterpenes into
 			   the ND29 diagnostic for the Tagged CO simulation.

emiss_tagged_co		-- Now take CO emissions from the EMISRR array, 
("tagged_co_mod.f")        which is archived by calling EMISSDR
			-- Remove duplicate scaling and other operations 
                           which are now done in EMISSDR. 	
			-- Remove references to BIOFUEL_BURN, GEIA_MOD,
		           and GET_AREA_CM2.

fast_j.f		-- Now initialize the PJ array here, instead of two 
	                   layers below in "set_prof.f"
			-- Now no longer pass PRES to "photoj.f"

finite_dble		-- Now use FP_CLASS function for IFORT compiler
("error_mod.f")		-- Also comment out test for NaN on Sun for now

finite_float            -- Now use FP_CLASS function for IFORT compiler
("error_mod.f")		-- Also comment out test for NaN on Sun for now

get_a3_fields		-- Now read extra fields for GEOS-5
("a3_read_mod.f")

get_a6_fields		-- Now read CMFMC, DQIDTMST, DQLDTMST, DQRCON, DQRLSC,
("a6_read_mod.f")          DQVDTMST, MFXC, MFYC, MFZ, PV (aka EPV), QL, 
                           QI, RH, TAUCLI, TAUCLW for GEOS-5

get_flash_scale_cth	-- Add #if blocks for GEOS_5
("lightning_nox_nl_mod.f")

get_flash_scale_mflux	-- Add #if blocks for GEOS_5
("lightning_nox_nl_mod.f")

get_flash_scale_precon	-- Add #if blocks for GEOS_5
("lightning_nox_nl_mod.f")

get_global_ch4.f	-- Add the preindustrial CH4 scenarios
                        -- Also set 2001 as the default in case we are 
                           running 2030 or 2050 met but present-day emissions.

get_global_hno3		-- Renamed GRID30LEV to GRIDREDUCED
("global_hno3_mod.f")

get_global_o3		-- Renamed GRID30LEV to GRIDREDUCED
("global_hno3_mod.f")

get_i6_fields_1		-- Now also read TO3 and TTO3 for GEOS-5 
("i6_read_mod.f")

get_i6_fields_2		-- Now also read TO3 and TTO3 for GEOS-5 
("i6_read_mod.f")

get_l_copy		-- Now split GEOS_5 into a separate #ifdef block
("transfer_mod.f")

get_modelname		-- Rename GRID30LEV to GRIDREDUCED
("bpch2_mod.f")

get_n_a3		-- Increase # of fields for GEOS-5 to 25
("a3_read_mod.f")

get_n_a6		-- Increase # of fields for GEOS-5 to 21

get_n_i6		-- Increase # of fields for GEOS-5 to 5
("i6_read_mod.f")

get_otd_lis_scale       -- Added MFLUX, PRECON scaling for GEOS-4.  
("lightning_nox_mod.f") -- Also write messages for met field types/grids 
                           where scaling is not defined.

get_pedge		-- Now treat GEOS-5 the same way as GEOS-4 
("pressure_mod.f")         

get_regional_pox        -- Now use LLTROP instead of LLTROP_FIX
("tagged_ox_mod.f")

gfed2_compute_biomass   -- 2006 is now the last year of available data
("biomass_mod.f")

init_dao		-- Add extra fields for GEOS-5
("dao_mod.f")

init_diaginfo		-- Change diagnostic category for ND31 diagnostic 
("gamap_mod.f")            from "PS-PTOP" to "PEDGE-$"

init_diag_pl		-- Now only allocate arrays up to LD65 
("diag_pl_mod.f")

init_lightning_nox	-- Also update location of PDF file to 
("lightning_nox_mod.f")    lightning_NOx_200709 directory

init_pressure		-- Renamed GRID30LEV to GRIDREDUCED

init_transfer		-- Rewritten for clarity.  
("transfer_mod.f")      -- Remove references to "grid_mod.f" and 
                           "pressure_mod.f"
                        -- Now pass I0, J0 from "grid_mod.f" via the arg list

init_tracerinfo		-- Now write out PBLDEPTH diagnostic information to 
("gamap_mod.f")            "tracerinfo.dat" if any of ND41, ND48, ND49, ND50, 
                           ND51 are turned on

init_transport		-- Removed reference to USE_GEOS_4_TRANSPORT, 
("transport_mod.f")        STT_I1, STT_I2, STT_J1, STT_J2, variables

inphot.f		-- Removed ETAA and ETAB arrays.  We now compute PJ 
			   directly from the GET_PEDGE routine.  
			-- Also remove reference to "pressure_mod.f".  
			-- Updated comments

interp			-- Don't interpolate TROPP for GEOS-5
("dao_mod.f")

main.f			-- Now call LIGHTNING_NL for GEOS-5
			-- added tagged CO use statement
			-- added IF statement so that tagged CO 
                           simulation calls ANTHROEMS

mmran_16.f		-- Remove PRES as an argument, since we no longer 
                           need to pass that to PHOTOJ

nan_dble		-- Now use ISNAN function for IFORT compiler
("error_mod.f")	 	-- Also comment out test for NaN on Sun for now

nan_float               -- Now use ISNAN function for IFORT compiler
("error_mod.f")         -- Also comment out test for NaN on Sun for now

ndxx_setup.f		-- Now save true pressure edges for ND31 diagnostic
			-- Now stop the run if ND20 is defined but ND65 isn't

nfcldmx			-- Now make CLDMAS, DTRN as arguments, so that we 
("convection_mod.f")       can pass either GEOS-3 or GEOS-3 met data
			-- 

partition.f		-- Now do safe division to eliminate FP errors

photoj.f		-- We don't need to pass "P" via the arg list

pressure_mod.f		-- Added Ap and Bp for GEOS-5 met fields
			-- Updated comments

rainout			-- For GEOS-5, suppress rainout when T < 258K
("wetscav_mod.f")

read_a3			-- Add EVAP, GRN, GWETROOT, LAI, PRECSNO, SNODP
("a3_read_mod.f")          SNOMAS, and TROPP as optional arguments
			-- Also update the CASE statement accordingly 
			   for GEOS-5 fields
			-- Convert GEOS-5 PRECTOT and PRECCON fields from
                           [kg/m2/s] to [mm/day] for backwards compatibility

read_a6			-- Add CMFMC, DQIDTMST, DQLDTMST, DQRCON, DQRLSC,
("a6_read_mod.f")          DQVDTMST, MFXC, MFYC, MFZ, PLE, PV, QI, QL, RH, 
                           TAUCLI, and TAUCLW as optional arguments
			-- Also update the CASE statement accordingly 
			   for GEOS-5 fields
			-- Now reference TRANSFER_3D_Lp1 from "transfer_mod.f"
			-- Now convert GEOS-5 specific humidity from [kg/kg] 
			   to [g/kg] for compatibility with existing routines 

read_bpch2		-- Make TEMPARRAY big enough for GEOS-5 72 levels 
("bpch2_mod.f")            (and 73 edges) 

read_diagnostic_menu	-- Bug fix: Should use ND52 in call to SET_TINDEX 
("input_mod.f")         -- New error traps for OTD-LIS scaling, dependent on 
                           met field type.
                        -- Bug fix, create string variables for ERROR_STOP.

read_emissions_menu	-- Add new error traps for OTD-LIS options, 
("input_mod.f")	           dependent on met field type
			-- Also define error msg strings for ERROR_STOP

read_i6			-- Add EVAP, GRN, GWETROOT, LAI, SNODP, SNOMAS, and
("i6_read_mod")            TROPP as optional arguments
			-- Also update the CASE statement accordingly 
			   for GEOS-5 fields

read_pox_lox		-- Now use LLTROP instead of LLTROP_FIX
("tagged_ox_mod.f")

read_toms		-- Bug fix: don't include DATA_DIR in filename, just 
("toms_mod.f")             in case someone's file path has replaceable tokens

set_prof.f		-- We don't need to initialize the PJ array with ETAA 
			   and ETAB anymore.  PJ is now defined in "fast_j.f".
			-- Updated comments. (bmy, 10/30/07) 

src_dust_dead		-- Use SNOMAS (m H2O) for GEOS-5
("dust_mod.f")

tpcore_fvdas		-- Bug fix: get the flux at the bottom of the box at 
("tpcore_fvdas_mod.f")     the top of the atmosphere.  Unlike "tpcore_mod.f" 
                           for GEOS3, here the MASSFLUP is defined as the flux
                           into the bottom of the box.  It is not necessarily 
                           zero at the bottom of the atmosphere by design.  
                           This is just a representation, the flux differences 
	                   that really matter are correct.  
                        -- Also note that N/S flux are not 100% accurate, 
                           because of the RGW_25 factor: N flux out is not 
                           exactly equal to S flux into next box. 

tracerid		-- To satisfy IF statement in EMISSDR for using 
("tracerid_mod.f")         EMFOSSIL, we need to set IDECO=1 instead of IDECO=2

transfer_a6		-- Now break GEOS-5 into a separate #ifdef block 
("transfer_mod.f")

transfer_3d		-- Now break GEOS-5 into a separate #ifdef block 

transport_mod.f		-- Split off GCAP, GEOS-3, GEOS-4/GEOS-5 
                           specific calling sequences into separate 
                           subroutines
                        -- Also removed some obsolete module variables
                           (STT_I1, STT_I2, STT_J1, STT_J2, DSIG,
                            USE_GEOS_4_TRANSPORT)

wetdep			-- Redimension DSTT with NSOL instead of NSOLMAX. 
("wetscav_mod.f")          In many cases, NSOL is less than NSOLMAX and 
                           this will help to save memory especially when
                           running at 2x25 or greater resolution

write20			-- Now only write up to LD65 levels
("diag_pl_mod.f")

write_diag50		--  RH should be tracer #17 under "TIME-SER" category
("diag50_mod.f")

write_diag51		--  RH should be tracer #17 under "TIME-SER" category
("diag50_mod.f")