#!/usr/bin/perl -w

#==============================================================================
# $Id: build,v 1.4 2003/11/06 21:07:17 bmy Exp $
#
# Perl script "build" compiles GEOS-CHEM with the correct makefile for 
# the given operating system.  Calls the Unix "uname" function to return
# the operating system name.  (bmy, 11/4/03)
#
# Arguments as Input:
# -----------------------------------------------------------------------------
# (1 ) $target : Name of the makefile target to build (default is "geos")
#
# NOTES:
# (1 ) Special handling for ALTIX (bmy, 11/4/03)
#==============================================================================

# Local variables
my $target = "geos";
my $OSName = "";
my $nName  = "";

# If an argument has been passed, then redefine $target 
if ( scalar( @ARGV ) > 0 ) { $target = $ARGV[0]; }

# Get the OS name via system call
$OSName = qx( uname -s );

# Get the nodename via system call
$nName  = qx( uname -n );

# Error check the system call
if ( $? != 0 ) { 
   print "Error obtaining operating system name!\n";
   exit(1);
}

# Compile GEOS-CHEM w/ the right makefile
if    ( $OSName =~ "IRIX"  ) { qx( make $target -f Makefile.sgi      ); }
elsif ( $OSName =~ "OSF1"  ) { qx( make $target -f Makefile.compaq   ); } 
elsif ( $OSName =~ "SunOS" ) { qx( make $target -f Makefile.sun      ); }
elsif ( $OSName =~ "AIX"   ) { qx( make $target -f Makefile.ibm      ); }

# If ALTIX, then use ifc compiler, Other Linuxes use PGI compiler
elsif ( $OSName =~ "Linux" ) { 
  if  ( $nName  =~ "altix" ) { qx( make $target -f Makefile.intel_fc ); }
  else                       { qx( make $target -f Makefile.linux    ); }
}
  
# Exit normally
exit(0);
